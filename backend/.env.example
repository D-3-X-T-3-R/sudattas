# ============================================================
# Sudattas Backend — Environment Variables
# Copy this file to the relevant service directory as .env
# and fill in real values. Never commit .env with real secrets.
#
# Production: set all secrets via environment or a secret manager;
# do not use example values in production. See CONFIG.md.
# ============================================================

# ----- Database (required by core_db_entities / core_operations) -----
# Full MySQL connection string
DATABASE_URL=mysql://user:password@host:3306/SUDATTAS

# Connection pool settings (all optional — defaults shown)
DB_MAX_CONNECTIONS=10
DB_MIN_CONNECTIONS=1
DB_CONNECT_TIMEOUT_SEC=30
DB_IDLE_TIMEOUT_SEC=600
DB_MAX_LIFETIME_SEC=1800

# ----- gRPC (required) -----
# Address the gRPC server binds to (core_operations)
GRPC_SERVER=0.0.0.0:50051

# Address the GraphQL service uses to reach the gRPC server (graphql)
GRPC_URL=http://localhost:50051

# Shared bearer token for internal GraphQL→gRPC auth.
# Generate with: openssl rand -hex 32
# If unset, gRPC auth is disabled (dev/local only — always set in production).
GRPC_AUTH_TOKEN=change_me_use_openssl_rand_hex_32

# ----- OAuth / JWT (required by graphql) -----
# Auth0 (or compatible OIDC) domain, including trailing slash
RAZORPAY_WEBHOOK_SECRET=your_razorpay_webhook_secret_here

OAUTH_DOMAIN=https://your-tenant.eu.auth0.com/

# Audience for JWT validation (note: OAUTH_AUDIANCE is also accepted for compatibility)
OAUTH_AUDIENCE=https://your-tenant.eu.auth0.com/api/v2/

# ----- Redis / Session (optional) -----
# If set, Redis is used for session management; omit to disable sessions
REDIS_URL=redis://127.0.0.1:6379

# ----- Cloudflare R2 / Image storage (required if using image upload) -----
R2_ACCOUNT_ID=your-account-id
R2_ACCESS_KEY_ID=your-access-key-id
R2_SECRET_ACCESS_KEY=your-secret-access-key
R2_ENDPOINT=https://<account-id>.r2.cloudflarestorage.com
R2_BUCKET_NAME=sudattas-images
R2_PUBLIC_URL=https://images.yourdomain.com

# Max upload size in MB (default: 10)
MAX_IMAGE_SIZE_MB=10

# ----- GraphQL server (optional) -----
# Socket address for the GraphQL HTTP server (default: 0.0.0.0:8080)
GRAPHQL_LISTEN_ADDR=0.0.0.0:8080

# ----- Resilience & rate limiting (optional) -----
# Per-IP rate limit: requests per minute for GraphQL (0 = disabled, default 60)
RATE_LIMIT_PER_MINUTE=60
# Per-IP rate limit for webhook endpoints (0 = disabled, default 30)
RATE_LIMIT_WEBHOOK_PER_MINUTE=30
# GraphQL query depth limit (default 10); rejects overly nested queries with 400
GRAPHQL_MAX_QUERY_DEPTH=10
# gRPC client: request timeout (s), connect timeout (s), connect retries
GRPC_REQUEST_TIMEOUT_SEC=30
GRPC_CONNECT_TIMEOUT_SEC=10
GRPC_CONNECT_RETRIES=2
# Circuit breaker: open after N connect failures, cooldown (s)
GRPC_CIRCUIT_BREAKER_FAILURES=5
GRPC_CIRCUIT_BREAKER_COOLDOWN_SEC=30
# Idempotency: cache window in hours for place_order and capture_payment (default 24)
IDEMPOTENCY_WINDOW_HOURS=24

# ----- Logging -----
# Tracing filter for GraphQL service (logs are JSON in production)
RUST_LOG=info
